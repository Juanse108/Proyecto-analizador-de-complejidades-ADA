version: "3.9"
services:
  orchestrator:
    build: ./orchestrator_service
    ports: ["8000:8000"]
    environment:
      PARSER_URL: http://parser:8001
      ANALYZER_URL: http://analyzer:8002
      LLM_URL: http://llm:8003
    depends_on:
      - parser
      - analyzer
      - llm
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  parser:
    build: ./parser_service
    ports: ["8001:8001"]
    command: uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload

  analyzer:
    build: ./core_analyzer_service
    ports: ["8002:8002"]
    command: uvicorn app.main:app --host 0.0.0.0 --port 8002 --reload

  llm:
    build: ./llm_service
    ports: ["8003:8003"]
    environment:
      GEMINI_MODEL: ${GEMINI_MODEL:-gemini-2.0-flash}
      GEMINI_API_KEY: ${GEMINI_API_KEY:-AIzaSyAHecVUUB9dgXHlxqdQeKLB5yk8UVndIuM}
      GEMINI_TIMEOUT: ${GEMINI_TIMEOUT:-30}
      LLM_RETRY_MAX: ${LLM_RETRY_MAX:-4}
      LLM_RETRY_BASE: ${LLM_RETRY_BASE:-0.7}
      LLM_FALLBACK_MODELS: ${LLM_FALLBACK_MODELS:-gemini-2.0-pro}
    dns:
      - 8.8.8.8
      - 1.1.1.1
    command: uvicorn app.main:app --host 0.0.0.0 --port 8003 --reload
